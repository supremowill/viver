<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Game Ranking - Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      }
      
      .glass-effect {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      
      .gradient-bg {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }
      
      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        transition: all 0.3s ease;
      }
      
      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
      }
      
      .input-field {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
      }
      
      .input-field:focus {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(102, 126, 234, 0.5);
        box-shadow: 0 0 20px rgba(102, 126, 234, 0.2);
      }
      
      .hidden {
        display: none !important;
      }
      
      .fade-in {
        animation: fadeIn 0.5s ease-in;
      }
      
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }
    </style>
  </head>
  <body>
    <!-- Login Screen -->
    <div id="loginScreen" class="gradient-bg flex items-center justify-center p-4">
      <div class="glass-effect rounded-2xl p-8 w-full max-w-md fade-in">
        <div class="text-center mb-8">
          <div class="text-6xl mb-4">üéÆ</div>
          <h1 class="text-3xl font-bold text-white mb-2" id="authTitle">Entrar</h1>
          <p class="text-white/70" id="authSubtitle">Entre para acessar o ranking</p>
        </div>

        <form id="authForm" class="space-y-6">
          <div>
            <label for="email" class="block text-sm font-medium text-white/90 mb-2">
              Email
            </label>
            <input
              id="email"
              type="email"
              required
              class="input-field w-full px-4 py-3 rounded-lg text-white placeholder-white/50 focus:outline-none"
              placeholder="seu@email.com"
            />
          </div>

          <div>
            <label for="password" class="block text-sm font-medium text-white/90 mb-2">
              Senha
            </label>
            <input
              id="password"
              type="password"
              required
              class="input-field w-full px-4 py-3 rounded-lg text-white placeholder-white/50 focus:outline-none"
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
            />
          </div>

          <button
            type="submit"
            id="authButton"
            class="btn-primary w-full text-white font-semibold py-3 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-transparent"
          >
            Entrar
          </button>
        </form>

        <div id="authMessage" class="mt-4 p-3 rounded-lg text-sm hidden"></div>

        <div class="mt-6 text-center">
          <button
            id="toggleAuth"
            class="text-blue-300 hover:text-blue-200 text-sm transition-colors"
          >
            N√£o tem conta? Criar uma
          </button>
        </div>

        <div id="loadingIndicator" class="hidden mt-4 text-center">
          <div class="inline-flex items-center text-white/70">
            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Carregando...
          </div>
        </div>
      </div>
    </div>

    <!-- Game Screen -->
    <div id="gameScreen" class="hidden">
      <div id="react-root"></div>
    </div>

    <script type="module">
      // Configura√ß√£o do Supabase
      const supabaseUrl = import.meta.env.VITE_SUPABASE_URL || 'YOUR_SUPABASE_URL'
      const supabaseKey = import.meta.env.VITE_SUPABASE_ANON_KEY || 'YOUR_SUPABASE_ANON_KEY'
      
      // Verificar se as vari√°veis de ambiente est√£o configuradas
      if (supabaseUrl === 'YOUR_SUPABASE_URL' || supabaseKey === 'YOUR_SUPABASE_ANON_KEY') {
        console.error('‚ö†Ô∏è Configura√ß√£o do Supabase necess√°ria!')
        document.getElementById('authMessage').innerHTML = `
          <div class="bg-yellow-500/20 text-yellow-300 border border-yellow-500/30 p-3 rounded-lg">
            ‚ö†Ô∏è Configure as vari√°veis VITE_SUPABASE_URL e VITE_SUPABASE_ANON_KEY no arquivo .env
          </div>
        `
        document.getElementById('authMessage').classList.remove('hidden')
      }
      
      const supabase = window.supabase.createClient(supabaseUrl, supabaseKey)

      // Elementos DOM
      const loginScreen = document.getElementById('loginScreen')
      const gameScreen = document.getElementById('gameScreen')
      const authForm = document.getElementById('authForm')
      const authTitle = document.getElementById('authTitle')
      const authSubtitle = document.getElementById('authSubtitle')
      const authButton = document.getElementById('authButton')
      const toggleAuth = document.getElementById('toggleAuth')
      const authMessage = document.getElementById('authMessage')
      const loadingIndicator = document.getElementById('loadingIndicator')
      const emailInput = document.getElementById('email')
      const passwordInput = document.getElementById('password')

      // Estado da aplica√ß√£o
      let isSignUp = false
      let currentUser = null

      // Verificar sess√£o existente
      checkExistingSession()

      async function checkExistingSession() {
        try {
          const { data: { session } } = await supabase.auth.getSession()
          if (session) {
            currentUser = session.user
            showGameScreen()
          }
        } catch (error) {
          console.error('Erro ao verificar sess√£o:', error)
        }
      }

      // Toggle entre login e cadastro
      toggleAuth.addEventListener('click', () => {
        isSignUp = !isSignUp
        updateAuthUI()
      })

      function updateAuthUI() {
        if (isSignUp) {
          authTitle.textContent = 'Criar Conta'
          authSubtitle.textContent = 'Crie sua conta para salvar seus scores'
          authButton.textContent = 'Criar Conta'
          toggleAuth.textContent = 'J√° tem uma conta? Entrar'
        } else {
          authTitle.textContent = 'Entrar'
          authSubtitle.textContent = 'Entre para acessar o ranking'
          authButton.textContent = 'Entrar'
          toggleAuth.textContent = 'N√£o tem conta? Criar uma'
        }
        hideMessage()
      }

      // Manipular formul√°rio de autentica√ß√£o
      authForm.addEventListener('submit', async (e) => {
        e.preventDefault()
        
        const email = emailInput.value.trim()
        const password = passwordInput.value.trim()

        if (!email || !password) {
          showMessage('Por favor, preencha todos os campos.', 'error')
          return
        }

        if (password.length < 6) {
          showMessage('A senha deve ter pelo menos 6 caracteres.', 'error')
          return
        }

        showLoading(true)
        hideMessage()

        try {
          if (isSignUp) {
            const { data, error } = await supabase.auth.signUp({
              email,
              password,
            })

            if (error) throw error

            if (data.user) {
              showMessage('Conta criada com sucesso! Voc√™ j√° pode fazer login.', 'success')
              // Alternar para modo de login ap√≥s cadastro bem-sucedido
              setTimeout(() => {
                isSignUp = false
                updateAuthUI()
              }, 2000)
            }
          } else {
            const { data, error } = await supabase.auth.signInWithPassword({
              email,
              password,
            })

            if (error) throw error

            if (data.user) {
              currentUser = data.user
              showGameScreen()
            }
          }
        } catch (error) {
          console.error('Erro de autentica√ß√£o:', error)
          showMessage(getErrorMessage(error.message), 'error')
        } finally {
          showLoading(false)
        }
      })

      function getErrorMessage(errorMessage) {
        const errorMap = {
          'Invalid login credentials': 'Email ou senha incorretos.',
          'User already registered': 'Este email j√° est√° cadastrado.',
          'Password should be at least 6 characters': 'A senha deve ter pelo menos 6 caracteres.',
          'Invalid email': 'Email inv√°lido.',
          'Email not confirmed': 'Email n√£o confirmado. Verifique sua caixa de entrada.',
        }
        
        return errorMap[errorMessage] || `Erro: ${errorMessage}`
      }

      function showMessage(message, type) {
        authMessage.className = `mt-4 p-3 rounded-lg text-sm ${
          type === 'success' 
            ? 'bg-green-500/20 text-green-300 border border-green-500/30' 
            : 'bg-red-500/20 text-red-300 border border-red-500/30'
        }`
        authMessage.textContent = message
        authMessage.classList.remove('hidden')
      }

      function hideMessage() {
        authMessage.classList.add('hidden')
      }

      function showLoading(show) {
        if (show) {
          loadingIndicator.classList.remove('hidden')
          authButton.disabled = true
          authButton.style.opacity = '0.5'
        } else {
          loadingIndicator.classList.add('hidden')
          authButton.disabled = false
          authButton.style.opacity = '1'
        }
      }

      function showGameScreen() {
        loginScreen.classList.add('hidden')
        gameScreen.classList.remove('hidden')
        
        // Carregar a aplica√ß√£o React
        loadReactApp()
      }

      async function loadReactApp() {
        try {
          // Importar e inicializar a aplica√ß√£o React
          const { default: React } = await import('react')
          const { createRoot } = await import('react-dom/client')
          const { default: App } = await import('./src/App.tsx')
          
          const container = document.getElementById('react-root')
          const root = createRoot(container)
          root.render(React.createElement(App))
        } catch (error) {
          console.error('Erro ao carregar aplica√ß√£o:', error)
          document.getElementById('react-root').innerHTML = `
            <div class="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center">
              <div class="text-white text-center">
                <div class="text-6xl mb-4">‚ö†Ô∏è</div>
                <h2 class="text-2xl font-bold mb-2">Erro ao carregar aplica√ß√£o</h2>
                <p class="text-white/70 mb-4">Verifique se todas as depend√™ncias est√£o instaladas.</p>
                <button onclick="location.reload()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                  Recarregar
                </button>
              </div>
            </div>
          `
        }
      }

      // Escutar mudan√ßas de autentica√ß√£o
      supabase.auth.onAuthStateChange((event, session) => {
        if (event === 'SIGNED_IN') {
          currentUser = session.user
          showGameScreen()
        } else if (event === 'SIGNED_OUT') {
          currentUser = null
          gameScreen.classList.add('hidden')
          loginScreen.classList.remove('hidden')
          // Limpar formul√°rio
          emailInput.value = ''
          passwordInput.value = ''
          hideMessage()
        }
      })

      // Adicionar funcionalidade de logout global
      window.logout = async () => {
        try {
          await supabase.auth.signOut()
        } catch (error) {
          console.error('Erro ao fazer logout:', error)
        }
      }

      // Expor Supabase globalmente para uso na aplica√ß√£o React
      window.supabaseClient = supabase
      window.currentUser = () => currentUser
    </script>
  </body>
</html>